<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">
            <p-toast></p-toast>
            <p-toolbar styleClass="mb-4">
                <ng-template pTemplate="left">
                    <div class="my-2">
                        <button pButton pRipple label="Nuevo usuario" icon="pi pi-plus" class="p-button-success mr-2" (click)="openNew()"></button>
                    </div>
                </ng-template>
            </p-toolbar>

            @if (loading) {
                <app-pg-tabla [title]="tableConfig.title" [data]="tableConfig.data" [cols]="tableConfig.cols" [globalFilterFields]="tableConfig.globalFilterFields"></app-pg-tabla>
            }
        </div>

        <p-dialog [(visible)]="productDialog" [style]="{width: '500px'}" header="Usuario" [modal]="true" class="p-fluid">
            <form [formGroup]="formUsuario" (ngSubmit)="crearUsuario()">
            
                <div class="field">
                    <label for="ci">Cédula de identidad</label>
                    <input formControlName="ci" type="text" pInputText id="ci" />
                    @if (formUsuario.get('ci')?.hasError('required') && formUsuario.get('ci')?.touched) {
                    <small> El campo cédula de identidad es requerido </small>
                    }
                    @if (formUsuario.get('ci')?.hasError('minlength') && formUsuario.get('ci')?.touched) {
                    <small> El campo cédula de identidad debe tener al menos 7 caracteres </small>
                    }
                </div>
            
                <div class="field">
                    <label for="nombres">Nombres</label>
                    <input formControlName="nombres" type="text" pInputText id="nombres" />
                    @if (formUsuario.get('nombres')?.hasError('required') && formUsuario.get('nombres')?.touched) {
                    <small> El campo nombres es requerido </small>
                    }
                    @if (formUsuario.get('nombres')?.hasError('minlength') && formUsuario.get('nombres')?.touched) {
                    <small> El campo nombres debe tener al menos 3 caracteres </small>
                    }
                </div>
            
                <div class="field">
                    <label for="apellidos">Apellidos</label>
                    <input formControlName="apellidos" type="text" pInputText id="apellidos" />
                    @if (formUsuario.get('apellidos')?.hasError('required') && formUsuario.get('apellidos')?.touched) {
                    <small> El campo apellidos es requerido </small>
                    }
                    @if (formUsuario.get('apellidos')?.hasError('minlength') && formUsuario.get('apellidos')?.touched) {
                    <small> El campo apellidos debe tener al menos 3 caracteres </small>
                    }
                </div>
            
                <div class="field">
                    <label for="cargo">Cargo</label>
                    <input formControlName="cargo" type="text" pInputText id="cargo" />
                    @if (formUsuario.get('cargo')?.hasError('required') && formUsuario.get('cargo')?.touched) {
                    <small> El campo cargo es requerido </small>
                    }
                </div>

                <div class="field">
                    <label for="telefono">Teléfono</label>
                    <input formControlName="telefono" type="text" pInputText id="telefono" />
                </div>

                <div class="field">
                    <label for="email">Email</label>
                    <input formControlName="email" type="text" pInputText id="email" />
                    @if (formUsuario.get('email')?.hasError('required') && formUsuario.get('email')?.touched) {
                    <small> El campo email es requerido </small>
                    }
                    @if (formUsuario.get('email')?.hasError('email') && formUsuario.get('email')?.touched) {
                    <small> El campo debe ser un email válido </small>
                    }
                </div>
            
                <div class="field" [ngStyle]="{'display': !editting ? 'block' : 'none'}">
                    <label for="password">Contraseña</label>
                    <p-password formControlName="password"
                        promptLabel="Elige una contraseña"
                        weakLabel="Muy simple"
                        mediumLabel="Moderada"
                        strongLabel="Segura"
                        [toggleMask]="true" inputId="password" />
                    @if (formUsuario.get('password')?.hasError('required') && formUsuario.get('password')?.touched) {
                    <small> El campo constraseña es requerido </small>
                    }
                    @if (formUsuario.get('password')?.hasError('minlength') && formUsuario.get('password')?.touched) {
                    <small> El campo constraseña debe tener al menos 8 caracteres </small>
                    }
                </div>
            
                <div class="field">
                    <label for="id_rol">Rol</label>
                    <p-dropdown formControlName="id_rol" inputId="id_rol" [options]="listaRolesDropdown" optionLabel="name"
                        placeholder="Seleccione un rol" [appendTo]="'body'" />
                    @if (formUsuario.get('id_rol')?.hasError('required') && formUsuario.get('id_rol')?.touched) {
                    <small> El campo rol es requerido </small>
                    }
                </div>
            
                <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" type="button"
                    (click)="hideDialog()"></button>
                <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" type="submit"></button>
            
            </form>
        </p-dialog>

    </div>
</div>
